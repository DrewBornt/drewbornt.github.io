---
title: Pentesting Methodology
draft: 
tags:
---
# About

As I have began progressing my skills with penetration testing, red teaming, and ethical hacking, I have began to develop a hacking methodology of my own. Largely grounded in the frameworks from various agencies like the Cyber Kill Chain and MITRE ATT&CK. My methodology will be based in the context of a penetration test or penetration test exam, like [[eJPT]], PNPT, eCPPT, or OCSP. The intent here is *NOT* to be discrete or attempt to hide ourselves on the network. This is a living document, so as my experience grows, my methodology may change. I will work to keep this up to date.

# Host Discovery
If a target IP address is not provided, like how THM and HTB explicitly tell you the IP of the machine, discovering hosts on the network may be important. Typically, in an exam you will either be given an attack box already on the network or a VPN file with which you will connect to the remote network. Your Rules of Engagement will outline the networks you're allowed to attack.

`ip addr` will reveal our attack box's IP address and subnet. With this, we can then run our host discovery scan with nmap (or rustscan, which I will detail later). 

## Nmap
### Basic Ping Sweep
```
nmap -sn <IP/CIDR>
```
- `<IP/CIDR>` will look something like `192.168.0.0/24` if you have an IP address of 192.168.0.x and a subnet mask of 255.255.255.0
- `-sn` disables port scanning
- Sometimes ICMP will be blocked by the firewall of a host
### SYN Sweep
```
nmap -sn -PS <IP/CIDR>
```
- Uses SYN packets
- Scans port 80 by default, but can be customized.
### ACK Sweep
```
nmap -sn -PA <IP/CIDR>
```
- `-PA` performs an ACK scan.
- This will receive a RST packet if the host is up
- May get blocked by Windows Firewall
### Common Port Check
```
nmap -sn -T4 -PS21,22,25,80,445,3389,8080 -PU137,138 <IP/CIDR>
```
- Checks 2 common UDP ports
- Checks 7 common TCP ports
- By no means exhaustive, but likely the most common ports to be found. Works as a fast scan for the usual culprits.

### What Next
After the hosts on a network are discovered, I personally use obsidian and give each host IP its own folder. Within that folder I will create notes labeled 'Port Scan', 'Accounts Found', 'Enumeration', 'Exploits Found', and 'Method'. I cannot recommend enough that you take comprehensible notes.

# Port Scanning
This will be written exclusively written with Nmap in mind. However, in the future, I may switch to using rustscan and may change this at a future date. Technically, you CAN combine both of these scans, but it can be horribly slow. I may change my mind on this later if I combined them or not.

## Initial Scan
The initial scan is done AFTER each individual host is discovered on the network. The idea here is we want to find *ALL* of the open service ports before attepting to get service versions.
```
nmap -Pn -p- -T4 <IP>
```
- Do this for each host
- `-Pn` disables ping, which can be useful if firewall blocks ICMP, plus it's unnecessary network traffic.
- This doesn't check for UDP ports. If UDP is thought to be a concern, running a separate `-SU` scan could reveal any.

## Port Scan with Service Checking and OS detection

```
nmap -Pn -p #,##,###,###,<etc> -sV -sC -O <IP> -oA DiscoveredPortsScan
```
- `#,##,###,<etc>` can be replaced with the ports comma separated.
- Will put the output into the 3 different output formats. The XML version can be imported into Metasploit later.
- `-sV` will attempt to get service versions of the ports. 
- `-sC` will use the default set of scripts for any services discovered.
- `-O` will attempt OS discovery on the host. It usually gets it right enough. Later enumeration can find more correct version numbers.

